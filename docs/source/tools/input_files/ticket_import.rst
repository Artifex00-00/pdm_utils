.. _ticketimport:

Import tickets
==============

A structured, database ticketing system has been developed to import new data, make updates to the database, and maintain a record of updates. This ticketing system plays an integral component to the automated database management. For most types of updates to the database, there needs to be a unique 'ticket' in a csv-formatted import table that provides instructions on how to implement the update. Within the import table, an individual row of data populating 11 columns constructs a unique 'ticket'. The first field indicates the type of ticket, and the remaining 10 fields provide the necessary information for the ticket to be implemented.

    1. **Ticket Type**: there are currently four types of tickets that the import script can implement:

        **Add**: a new phage genome (Primary PhageID) needs to be added to the database.

        **Remove**: a phage genome (Secondary PhageID) currently in the database needs to be removed.

        **Replace**: a phage genome (Secondary PhageID) currently in the database needs to be replaced with a new phage genome (Primary PhageID).

        **Update**: no genome is being added, removed, or replaced, but new metadata for a phage genome (Primary PhageID) currently in the database needs to be updated.

    2. **Primary PhageID**: the name of the new phage genome that update, add, and replace tickets address. Ensure the phage name spelling precisely matches the name in the file.

    3. **Host Genus**: the genus of the bacterial host that the phage infects.

    4. **Cluster**: the Cluster designation for the phage.

    5. **Subcluster**: the Subcluster designation for the phage.

    6. **Annotation Status**: the stage of gene annotations (draft, final, unknown).

    7. **Annotation Author**: indicates whether SEA-PHAGES has control of the annotations.

    8. **Gene Description Field**: indicates which field of the CDS features in the associated Genbank-formatted flat file is expected to contain the gene descriptions (note, function, product).

    9. **Accession**: the accession for the NCBI record (if available).

    10. **Run mode**: indicates the run mode (pecaan, phagesdb, ncbi_auto, ncbi_misc, other, custom) for add and replace tickets, determining which QC checks are used to evaluate the associated flat file (:ref:`runmodes`).

    11. **Secondary PhageID**: indicates the name of the phage genome that will be removed in replace and remove tickets. Ensure the spelling precisely matches the PhageID in the database. Most often, this is simply the name of the phage that appears in Phamerator (e.g. If the genome in the database is a “draft” genome, this normally has “_Draft” appended to the phage name, and must be included here).

Import tickets are automatically generated by the ``pdm_utils`` 'get_data' pipeline, but they can also be manually generated.



Notes:

    1. Several fields can be set to “retrieve” to indicate that the data should be retrieved from PhagesDB:

        a. Host
        b. Cluster
        c. Subcluster
        d. Accession

    2. The import table should NOT include column headers. Headers are provided above only for illustration. Each row, beginning with Row 1, should contain phage information, and there should only be 11 columns populated for each row.

    3. Not all fields are applicable for every ticket type, but the 'import' tool requires that all fields are populated. Fields that do not contain relevant data for the ticket type should be populated with 'none'.
